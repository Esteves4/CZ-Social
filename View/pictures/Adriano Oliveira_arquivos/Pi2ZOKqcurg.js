/*1462215505,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ESPMu"]); }

__d('VideoCallTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:VideoCallLoggerConfig',this.$VideoCallTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:VideoCallLoggerConfig',this.$VideoCallTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$VideoCallTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$VideoCallTypedLogger1=babelHelpers['extends']({},this.$VideoCallTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$VideoCallTypedLogger1.event=j;return this;};h.prototype.setMessage=function(j){this.$VideoCallTypedLogger1.message=j;return this;};var i={event:true,message:true};f.exports=h;},null);
__d('ChatVideoCallButton.react',['cx','invariant','Bootloader','FBID','FBRTCCallabilityStore','Keys','Link.react','MercuryIDs','MercuryParticipants','MercuryThreads','ReactComponentWithPureRenderMixin','React','StoreAndPropBasedStateMixin','TrackingNodes','VideoCallTypedLogger'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('MercuryThreads').get(),k=c('React').PropTypes,l={isCallable:false,shown:false,user:null},m=c('React').createClass({displayName:'ChatVideoCallButton',mixins:[c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(c('FBRTCCallabilityStore'),c('MercuryParticipants'))],propTypes:{isAudio:k.bool,isGroupChat:k.bool,threadID:k.string,viewer:k.string.isRequired},statics:{calculateState:function(n){if(!n.threadID)return babelHelpers['extends']({},l);if(n.isGroupChat)return {isCallable:true,shown:true,user:null};var o=c('MercuryIDs').getUserIDFromThreadID(n.threadID);if(o===n.viewer||!c('FBID').isUser(o))return babelHelpers['extends']({},l);!(o&&c('FBID').isUser(o))?i(0):void 0;var p=c('MercuryIDs').getParticipantIDFromUserID(o),q=c('MercuryParticipants').getOrFetch(p);return {isCallable:c('FBRTCCallabilityStore').isCallable(o),shown:true,user:q};}},getTooltipLabel:function(){var n=this.state.user;if(!n)return undefined;return this.props.isAudio?c('FBRTCCallabilityStore').voiceCallButtonTooltip(n.fbid,n.short_name):c('FBRTCCallabilityStore').callButtonTooltip(n.fbid,n.short_name);},render:function(){if(!this.state.shown)return null;var n=c('TrackingNodes').getTrackingInfo(this.props.isAudio?c('TrackingNodes').types.VIDEOCHAT:c('TrackingNodes').types.VOICECHAT),o=JSON.stringify({videochat:'call_clicked_bhat_tab'});return (c('React').createElement(c('Link.react'),{'aria-label':this.getTooltipLabel(),className:"button"+(' '+"_3olv")+(this.props.isAudio?' '+"_2fpc":'')+(!this.props.isAudio?' '+"_2fpd":'')+(this.state.isCallable?' '+"enabled":''),'data-ft':n,'data-gt':o,'data-hover':'tooltip','data-tooltip-content':this.getTooltipLabel(),'data-tooltip-position':'above',onClick:this._handleClick,onKeyUp:this._handleKeyUp}));},_handleClick:function(n){n.preventDefault();if(!this.state.isCallable)return;this._initiateCall();},_handleKeyUp:function(n){n.preventDefault();if(n.keyCode!==c('Keys').RETURN||!this.state.isCallable)return;if(n.target){!(n.target instanceof HTMLElement)?i(0):void 0;n.target.blur();}this._initiateCall();},_initiateCall:function(){!!!this.props.threadID?i(0):void 0;var n=this.props.isAudio?'chat_tab_voice_icon':'chat_tab_icon';if(this.props.isGroupChat){j.getThreadMeta(this.props.threadID,function(o){var p=o.participants.map(function(r){return c('MercuryIDs').getUserIDFromParticipantID(r);}).filter(function(r){return r!==this.props.viewer;}.bind(this)),q={clickSource:n,conferenceName:'GROUP:'+o.thread_fbid,hasVideo:!this.props.isAudio,usersToRing:p};c('Bootloader').loadModules(["FBRTCCore"],function(r){r.startGroupCall(q);},'ChatVideoCallButton.react');}.bind(this));}else c('Bootloader').loadModules(["FBRTCCore"],function(o){o.startOutgoingCall(this.state.user.fbid,n,this.props.isAudio);new (c('VideoCallTypedLogger'))().setEvent('chat_tab_call_click').log();}.bind(this),'ChatVideoCallButton.react');}});f.exports=m;},null);